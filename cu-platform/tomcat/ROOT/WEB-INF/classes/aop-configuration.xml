<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:aop="http://www.springframework.org/schema/aop"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
	http://www.springframework.org/schema/beans/spring-beans.xsd
	http://www.springframework.org/schema/aop
	http://www.springframework.org/schema/aop/spring-aop.xsd">

    <aop:aspectj-autoproxy/>

    <bean id="taskExecutor"
          class="org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor">
        <property name="corePoolSize" value="5"/>
        <property name="maxPoolSize" value="10"/>
        <property name="queueCapacity" value="25"/>
    </bean>

    <!-- AOP Configuration -->
    <bean id="applicationAspect" class="fr.treeptik.cloudunit.aspects.ApplicationAspect"></bean>
    <bean id="serverAspect" class="fr.treeptik.cloudunit.aspects.ServerAspect"></bean>
    <bean id="moduleAspect" class="fr.treeptik.cloudunit.aspects.ModuleAspect"></bean>
    <bean id="deploymentAspect" class="fr.treeptik.cloudunit.aspects.DeploymentAspect"></bean>
    <bean id="fileExplorerAspect" class="fr.treeptik.cloudunit.aspects.FileExplorerAspect"></bean>
    <bean id="snapshotAspect" class="fr.treeptik.cloudunit.aspects.SnapshotAspect"></bean>

    <!--
    <bean name="serverAnnotationAspect" class="fr.treeptik.cloudunit.aspects.ServerAnnotationAspect" />
    -->

    <aop:config>

        <!-- +++++++++++ -->
        <!-- APPLICATION -->
        <!-- +++++++++++ -->
        <aop:aspect id="applicationAspect" ref="applicationAspect">

            <aop:pointcut id="applicationCreatePointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.ApplicationService.create(..)) "/>
            <aop:pointcut id="applicationUpdatePointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.ApplicationService.update(..)) "/>
            <aop:pointcut id="applicationRemovePointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.ApplicationService.remove(..)) "/>
            <aop:pointcut id="applicationStartPointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.ApplicationService.start(..)) "/>
            <aop:pointcut id="applicationStopPointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.ApplicationService.stop(..)) "/>
            <aop:pointcut id="applicationRestartPointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.ApplicationService.restart(..)) "/>

            <aop:before pointcut-ref="applicationCreatePointcut"
                        method="beforeApplication"/>
            <aop:before pointcut-ref="applicationUpdatePointcut"
                        method="beforeApplication"/>
            <aop:before pointcut-ref="applicationRemovePointcut"
                        method="beforeApplication"/>
            <aop:before pointcut-ref="applicationStartPointcut"
                        method="beforeApplication"/>
            <aop:before pointcut-ref="applicationStopPointcut" method="beforeApplication"/>
            <aop:before pointcut-ref="applicationRestartPointcut"
                        method="beforeApplication"/>

            <aop:after-returning pointcut-ref="applicationCreatePointcut"
                                 method="afterReturningApplication" returning="result"/>
            <aop:after-returning pointcut-ref="applicationUpdatePointcut"
                                 method="afterReturningApplication" returning="result"/>
            <aop:after-returning pointcut-ref="applicationRemovePointcut"
                                 method="afterReturningApplication" returning="result"/>
            <aop:after-returning pointcut-ref="applicationStartPointcut"
                                 method="afterReturningApplication" returning="result"/>
            <aop:after-returning pointcut-ref="applicationStopPointcut"
                                 method="afterReturningApplication" returning="result"/>
            <aop:after-returning pointcut-ref="applicationRestartPointcut"
                                 method="afterReturningApplication" returning="result"/>

            <aop:after-throwing pointcut-ref="applicationCreatePointcut"
                                method="afterThrowingApplication" throwing="e"/>
            <aop:after-throwing pointcut-ref="applicationUpdatePointcut"
                                method="afterThrowingApplication" throwing="e"/>
            <aop:after-throwing pointcut-ref="applicationRemovePointcut"
                                method="afterThrowingApplication" throwing="e"/>
            <aop:after-throwing pointcut-ref="applicationStartPointcut"
                                method="afterThrowingApplication" throwing="e"/>
            <aop:after-throwing pointcut-ref="applicationStopPointcut"
                                method="afterThrowingApplication" throwing="e"/>
            <aop:after-throwing pointcut-ref="applicationRestartPointcut"
                                method="afterThrowingApplication" throwing="e"/>

        </aop:aspect>


        <!-- ++++++ -->
        <!-- SERVER -->
        <!-- ++++++ -->
        <aop:aspect id="serverAspect" ref="serverAspect">

            <aop:pointcut id="serverCreatePointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.ServerService.create(..)) "/>
            <aop:pointcut id="serverSetOptionsPointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.ServerService.update(..)) "/>

            <!-- SERVER -->
            <aop:before pointcut-ref="serverSetOptionsPointcut"
                        method="beforeServer"/>

            <!-- SERVER -->
            <aop:after-returning pointcut-ref="serverSetOptionsPointcut"
                                 method="afterReturningServer" returning="result"/>

            <aop:after-throwing pointcut-ref="serverSetOptionsPointcut"
                                method="afterThrowingServer" throwing="e"/>

        </aop:aspect>


        <!-- ++++++ -->
        <!-- MODULE -->
        <!-- ++++++ -->
        <aop:aspect id="moduleAspect" ref="moduleAspect">

            <aop:pointcut id="moduleCreatePointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.ModuleService.initModule(..)) "/>

            <aop:pointcut id="moduleRemovePointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.ModuleService.remove(..)) "/>

            <aop:after-returning pointcut-ref="moduleCreatePointcut"
                                 method="beforeModule" returning="result"/>

            <aop:after-returning pointcut-ref="moduleRemovePointcut"
                                 method="beforeModule" returning="result"/>

            <aop:after-returning pointcut-ref="moduleCreatePointcut"
                                 method="afterReturningModule" returning="result"/>

            <aop:after-returning pointcut-ref="moduleRemovePointcut"
                                 method="afterReturningModule" returning="result"/>

            <aop:after-throwing pointcut-ref="moduleCreatePointcut"
                                method="afterThrowingModule" throwing="e"/>

            <aop:after-throwing pointcut-ref="moduleRemovePointcut"
                                method="afterThrowingModule" throwing="e"/>

        </aop:aspect>


        <!-- ++++++++++ -->
        <!-- DEPLOYMENT -->
        <!-- ++++++++++ -->
        <aop:aspect id="deploymentAspect" ref="deploymentAspect">
            <aop:after-returning pointcut-ref="deploymentPointcut"
                                 method="afterReturningDeployment" returning="result"/>
            <aop:after-returning pointcut-ref="deploymentPointcut"
                                 method="beforeDeployment" returning="result"/>
            <aop:pointcut id="deploymentPointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.DeploymentService.create(..)) "/>
        </aop:aspect>

        <!-- +++++++++++++ -->
        <!-- FILE EXPLORER -->
        <!-- +++++++++++++ -->
        <aop:aspect id="fileExplorerAspect" ref="fileExplorerAspect">
            <aop:pointcut id="deleteFilePointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.FileService.deleteFilesFromContainer(..)) "/>
            <aop:pointcut id="uploadFilePointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.FileService.sendFileToContainer(..)) "/>
            <aop:before pointcut-ref="deleteFilePointcut"
                        method="afterReturningFileExplorer"/>
            <aop:before pointcut-ref="uploadFilePointcut"
                        method="afterReturningFileExplorer"/>
        </aop:aspect>

        <!-- ++++++++ -->
        <!-- SNAPSHOT -->
        <!-- ++++++++ -->
        <aop:aspect id="snapshotAspect" ref="snapshotAspect">

            <aop:pointcut id="snapshotCreatePointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.SnapshotService.create(..)) "/>
            <aop:pointcut id="snapshotRemovePointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.SnapshotService.remove(..)) "/>
            <aop:pointcut id="snapshotClonePointcut"
                          expression="execution(* fr.treeptik.cloudunit.service.SnapshotService.cloneFromASnapshot(..)) "/>

            <aop:after-returning pointcut-ref="snapshotRemovePointcut"
                                 method="afterReturningSnapshot" returning="result"/>

            <aop:after-throwing pointcut-ref="snapshotCreatePointcut"
                                method="afterThrowingSnapshot" throwing="e"/>
            <aop:after-throwing pointcut-ref="snapshotRemovePointcut"
                                method="afterThrowingSnapshot" throwing="e"/>
            <aop:after-throwing pointcut-ref="snapshotClonePointcut"
                                method="afterThrowingSnapshot" throwing="e"/>
            <aop:after-returning pointcut-ref="snapshotCreatePointcut"
                                 method="afterReturningSnapshot" returning="result"/>
            <aop:after-returning pointcut-ref="snapshotClonePointcut"
                                 method="afterReturningSnapshot" returning="result"/>

        </aop:aspect>

    </aop:config>

</beans>
